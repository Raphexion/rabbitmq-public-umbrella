Release: RabbitMQ 2.7.1 (UNORDERED, NUMBERED COPY)

Release Highlights
==================

server
------
bug fixes
- the broker sometimes hung when recovering queues on startup
24392	normal	Broker	some rel	qi:load_segment can fail if unexpectedly encounters eof
- broker-generated queue names did not conform to AMQP syntax rules
24467	normal	Broker	some rel	Autogenerated queue names don't pass validation
- broker sometimes hung when closing channels and connection from multiple threads
24560	normal	Broker	next rel	Connection hangs in 'closing' state: race with channel closure
- high availability master nodes didn't recover properly
24561	normal	Broker	next rel	x-ha-policy=nodes doesn't fully cope with failure of master
- long-running brokers could suddenly crash due to global unique identifiers not being unique enough
24562	critica	Broker	next rel	guid generation broken; sky falling
- there was a slow memory link in mirrored queues with persistent (or confirmed) messages
24578	major	Broker	next rel	mirror queue slaves leaking memory with persistence & confirms
- queue equivalence check failed if arguments are sufficiently different
24579	normal	Broker	some rel	Error in queue equivalence check when queues have different arg keys
- rabbitmqctl list_connections could return incomplete information
24591	normal	Broker	next rel	'rabbitmqctl list_connections' may return nothing due to race
- promotion of a slave to master could fail when confirms are enabled
24608	major	Broker	next rel	qproc and mirror_slave disagree on data structure for msg_id_to_channel
- guaranteed multicast could fail under some circumstances with multiple participating nodes
24618	major	Broker	next rel	GM can crash when multiple nodes participate
- some functions were used that are not in the latest Erlang release
24628	major	Broker	next rel	gen_server2 uses global:safe_whereis_name/1 which is not in R15B

enhancements
- rabbitmqctl eval <expr> evaluates arbitrary Erlang expressions in the broker node
24593	normal	Broker	some rel	rabbitmqctl eval
- deletion of exchanges or queues with many bindings is more efficient
24607	normal	Broker	some rel	deleting exchanges/queues with lots of bindings is O(n^2)

java client
-----------
bug fixes
- defaults for the ConnectionFactory class were not public
24546	minor	Java client	some rel	ConnectionFactory defaults are not visible to the client
- part of the Java client API was hidden, causing application build errors
24550	minor	Java client	next rel	newConnection(Address[]) api removed from ConnectionFactory
- resources were not recovered if ConnectionFactory failed to connect
24567	minor	Java client	some rel	ExecutorService thread pools are shutdown only if the connection is established.
24597	normal	Java client	next rel	ConnectionFactory leaks sockets
- interrupts were mishandled in the Java threading logic
24569	normal	Java client	some rel	enqueueRpc mishandles interrupts

.net client
-----------
bug fixes
- session autoclose could fail with AlreadyClosedException
24464	normal	C# .NET client	some rel	Session autoclose race with close

plugins
-------
bug fixes
- consistent-hash-exchange mis-routed messages when handling multiple exchanges
24620	normal	Plug-ins	next rel	Consistent Hash Exchange can route messages wrongly when exchange has no bindings
- some tests and Erlang patches depended upon functions not in latest Erlang version
24626	minor	Plug-ins	some rel	rabbitmq-mochiweb tests fail under R15B
24627	normal	Plug-ins	next rel	eldap uses ssl:seed/1 which is not in R15B

management plugin
-----------------
bug fixes
- management plug-in could crash if it had limited permissions
24547	normal	Management Plugin	some rel	management plug-in fails to start due to /proc permission problems
- shovels were not displayed if they were in an undefined state
24549	normal	Management Plugin	some rel	"TypeError: point is undefined" in shovel-management
- slave synchronisation could sometimes be misrepresented on the management interface
24556	normal	Management Plugin	some rel	rabbit_mgmt_db:handle_slave_synchronised/3 breaks when slave already synchronised
- encoding of underscore in URL properties was incomplete
24586	normal	Management Plugin	some rel	Properties key generation only URL encodes the first '_'
- management interface could break if there were html syntax characters in names
24604	major	Management Plugin	next rel	Inadequate HTML escaping
24629	normal	Management Plugin	some rel	Cannot delete object whose name contains quotation mark
- overview could sometimes crash when another node starts up or shuts down
24609	normal	Management Plugin	next rel	/api/overview crashes while another node is starting up / shutting down
- statistics could be lost when nodes failed
24611	major	Management Plugin	next rel	Statistics database goes away in a cluster

enhancements
- rate of change of queue lengths has been added to the management user interface
24032	normal	Management Plugin	some rel	Show rate of change of queue lengths
- minor improvements to shovel information formatting
24557	normal	Plug-ins	some rel	rabbitmq-shovel-management formatting is rather unfortunate

auth-backend-ldap plugin
------------------------
enhancements
- accept a broader class of group objects on group_in filters
24610	normal	Plug-ins	some rel	[LDAP] in_group requires a groupOfNames objectClass

STOMP adapter
-------------
bug fixes
- duplicate headers were generated in some MESSAGE frames
24364	normal	STOMP gateway	some rel	duplicate special headers in MESSAGE
- temporary reply-to queues were not re-usable
24541	major	STOMP gateway	next rel	temp reply queues work only once
- functions were used not in the latest Erlang release
24572	normal	STOMP gateway	next rel	rabbit_stomp_util uses regexp module

build and packaging
-------------------
bug fixes
- rabbitmq-server mac osx portfile was incorrectly built
24559	major	Building/Packaging	next rel	Portfile for rabbitmq-server on macports is invalid
- maven bundle for Java client was not published to maven central
24545	minor	Building/Packaging	next rel	Maven staging and promotion fail in deploy script


Upgrading
=========
To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply install
the new version. All configuration and persistent message data is retained.

To upgrade a clustered RabbitMQ from release 2.1.1 or later, install the new
version on all the nodes and follow the instructions at
http://www.rabbitmq.com/clustering.html#upgrading .

To upgrade RabbitMQ from release 2.1.0, first upgrade to 2.1.1 (all data will be
retained), and then to the current version as described above.

When upgrading from RabbitMQ versions prior to 2.1.0, the existing data will be
moved to a backup location and a fresh, empty database will be created. A
warning is recorded in the logs. If your RabbitMQ installation contains
important data then we recommend you contact <support at rabbitmq.com> for
assistance with the upgrade.
